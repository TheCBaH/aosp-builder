FROM ubuntu:18.04
ARG userid
ARG groupid
ARG username
RUN set -eux;\
 apt-get update; apt-get install -y \
 bison \
 build-essential \
 ccache \
 curl \
 flex \
 gcc-multilib \
 git-core \
 g++-multilib \
 gnupg \
 gperf \
 lib32ncurses5-dev \
 lib32z-dev \
 libc6-dev-i386 \
 libgl1-mesa-dev \
 libx11-dev \
 libxml2-utils \
 python \
 unzip \
 x11proto-core-dev \
 xsltproc \
 zip \
 zlib1g-dev \
    ;apt-get clean;rm -rf /var/lib/apt/lists/*;\
    echo DONE
RUN set -eux; \
    curl -o /usr/local/bin/repo https://storage.googleapis.com/git-repo-downloads/repo; \
    chmod a+x /usr/local/bin/repo; \
    echo DONE
RUN set -eux; \
    groupadd -g $groupid $username; \
    useradd -m -u $userid -g $groupid $username; \
    echo $username >/root/username; \
    echo DONE
COPY entrypoint.sh /root/
COPY .gitconfig /root/
ENTRYPOINT ["/root/entrypoint.sh"]
CMD ["aosp"]
