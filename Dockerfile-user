FROM aosp:linux
ARG userid
ARG groupid
ARG username
RUN set -eux; \
    curl -o /usr/local/bin/repo https://storage.googleapis.com/git-repo-downloads/repo; \
    chmod a+x /usr/local/bin/repo; \
    echo DONE
RUN set -eux; \
    curl -o /usr/local/bin/repo https://storage.googleapis.com/git-repo-downloads/repo; \
    chmod a+x /usr/local/bin/repo; \
    echo DONE
RUN set -eux; \
    groupadd -g $groupid $username; \
    useradd -m -u $userid -g $groupid $username; \
    echo $username >/root/username; \
    echo DONE
COPY entrypoint.sh .gitconfig /root/
RUN set -eux; \
	git config --global color.ui false; \
    cp /root/.gitconfig /home/$username/; \
    chown $userid:$groupid /home/$username/.gitconfig; \
    echo DONE
ENTRYPOINT ["/root/entrypoint.sh"]
CMD ["build"]
